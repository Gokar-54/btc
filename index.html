<!doctype html>

<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù†Ø¸Ø§Ù… Ø¹ÙŠÙ† Ø§Ù„Ù†Ø³Ø± â€” Eagle Eye Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #020617; }
    .glass { background: rgba(255,255,255,0.06); backdrop-filter: blur(8px); border:1px solid rgba(255,255,255,0.08); }
    .counter-box { transition: 0.3s; }
    .counter-box:hover { transform: scale(1.03); }
  </style>
</head>
<body class="min-h-screen p-6 text-white">
  <div class="max-w-7xl mx-auto"><!-- HEADER -->
<div class="glass p-5 rounded-xl flex items-center gap-4 mb-6">
  <img src="https://img.icons8.com/?size=512&id=108556&format=png" class="w-24 drop-shadow-2xl" />
  <div>
    <div class="text-4xl font-extrabold text-cyan-300 drop-shadow">EAGLE EYE SYSTEM</div>
    <div class="text-sm opacity-70 mt-1">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø­ÙŠØ© â€” BTC/USDT â€” Ù†Ø³Ø®Ø© ÙˆÙŠØ¨ Ù…Ø·ÙˆÙ‘Ø±Ø©</div>
  </div>
</div>

<!-- MAIN GRID -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6">

  <!-- LEFT MAIN -->
  <div class="col-span-2 glass p-6 rounded-2xl">
    <div class="flex justify-between items-start">
      <div>
        <h2 class="text-xl opacity-70">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</h2>
        <div id="price" class="text-5xl font-extrabold text-cyan-300 mt-2">--</div>
        <div id="price-change" class="text-lg mt-1 opacity-80"></div>
      </div>
      <div class="text-right text-sm opacity-80">
        <div>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¢Ù†</div>
        <div id="now" class="font-semibold mt-1">--</div>
        <div class="mt-3">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: <span id="requests">0</span></div>
      </div>
    </div>

    <hr class="my-5 border-gray-700" />

    <!-- SUPPORT & RES -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <div class="glass p-4 rounded-xl counter-box text-center">
        <div class="text-xs opacity-70">Ø§Ù„Ø¯Ø¹Ù…</div>
        <div id="support" class="text-2xl font-bold text-green-300">--</div>
      </div>
      <div class="glass p-4 rounded-xl counter-box text-center">
        <div class="text-xs opacity-70">Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø©</div>
        <div id="resistance" class="text-2xl font-bold text-red-300">--</div>
      </div>
      <div class="glass p-4 rounded-xl counter-box text-center">
        <div class="text-xs opacity-70">Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
        <div id="signal" class="text-2xl font-bold text-yellow-300">âšª Ø§Ù†ØªØ¸Ø§Ø±</div>
        <div id="signal-txt" class="text-xs opacity-80 mt-1"></div>
      </div>
    </div>

    <hr class="my-5 border-gray-700" />

    <!-- CUMULATIVE -->
    <h3 class="font-semibold text-lg mb-3">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ±Ø§ÙƒÙ…</h3>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <div class="glass p-4 rounded-xl counter-box text-center">
        <div class="text-xs opacity-70">Ø´Ø±Ø§Ø¡ ØªØ±Ø§ÙƒÙ…ÙŠ (BTC)</div>
        <div id="cum-buys" class="text-2xl font-bold text-green-300">0.0000</div>
      </div>
      <div class="glass p-4 rounded-xl counter-box text-center">
        <div class="text-xs opacity-70">Ø¨ÙŠØ¹ ØªØ±Ø§ÙƒÙ…ÙŠ (BTC)</div>
        <div id="cum-sells" class="text-2xl font-bold text-red-300">0.0000</div>
      </div>
      <div class="glass p-4 rounded-xl counter-box text-center">
        <div class="text-xs opacity-70">Ø§Ù„ÙØ±Ù‚ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ</div>
        <div id="cum-diff" class="text-2xl font-bold text-cyan-300">0.0000</div>
      </div>
    </div>

  </div>

  <!-- RIGHT PANEL -->
  <div class="glass p-6 rounded-2xl">
    <h3 class="font-semibold text-lg">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø«Ø§Ù†ÙŠØ©</h3>
    <div class="mt-4 text-sm">
      <div>Ø´Ø±Ø§Ø¡ / Ø«Ø§Ù†ÙŠØ©: <span id="sec-buy" class="text-green-300">0.0000</span></div>
      <div>Ø¨ÙŠØ¹ / Ø«Ø§Ù†ÙŠØ©: <span id="sec-sell" class="text-red-300">0.0000</span></div>
      <div class="mt-2">Ø§Ù„ÙØ±Ù‚: <span id="sec-diff" class="text-cyan-300">0.0000</span></div>
    </div>
    <hr class="my-5 border-gray-700" />
    <h3 class="font-semibold mb-2">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
    <div class="text-xs opacity-80">
      Ø¹ØªØ¨Ø© Ø§Ù„ØªÙØ§ÙˆØª: <input id="vol-threshold" class="w-20 text-black rounded px-1" value="10"> BTC<br>
      ÙˆÙ‚Øª Ø§Ù„ØªØ¨Ø±ÙŠØ¯ (Ø«): <input id="cooldown" class="w-20 text-black rounded px-1 mt-2" value="20">
    </div>
  </div>

</div>

<footer class="mt-10 text-center text-xs opacity-60">Eagle Eye Dashboard â€” ØªÙ… Ø§Ù„ØªØµÙ…ÙŠÙ… Ø®ØµÙŠØµÙ‹Ø§ Ù„Ùƒ</footer>

  </div>  <script>
  /* ====== LOCAL STORAGE PERSISTENCE (Ù„Ø§ ÙŠØ¹ÙˆØ¯ Ø§Ù„ØµÙØ± Ø£Ø¨Ø¯Ø§Ù‹) ====== */
  let state = {
    prevPrice: 0,
    cumBuys: 0,
    cumSells: 0,
    lastTradeId: null,
    secBuy: 0,
    secSell: 0,
    lastSecondTs: 0,
    requestCount: 0,
    volThreshold: 10,
    cooldownSec: 20,
    lastSignalTime: 0,
    currentSignal: 'âšª Ø§Ù†ØªØ¸Ø§Ø±',
    currentTxt: ''
  };

  function saveState(){ localStorage.setItem('eagle_state', JSON.stringify(state)); }
  function loadState(){ const saved = localStorage.getItem('eagle_state'); if(saved){ Object.assign(state, JSON.parse(saved)); }}
  loadState();

  const API={ ticker:'https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT', depth:'https://api.binance.com/api/v3/depth?symbol=BTCUSDT&limit=50', trades:'https://api.binance.com/api/v3/trades?symbol=BTCUSDT&limit=100'};

  function f(x){return Number(x).toFixed(4)}
  function fp(x){return Number(x).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})}

  async function fetchJson(url){ try{const r=await fetch(url); if(!r.ok) throw 0; state.requestCount++; return r.json();}catch{return null;} }

  function supportRes(ob){
    const bids=(ob?.bids||[]).map(b=>[+b[0],+b[1]]);
    const asks=(ob?.asks||[]).map(a=>[+a[0],+a[1]]);
    const support=bids.length? bids.reduce((a,b)=>a[1]>b[1]?a:b)[0]:0;
    const resistance=asks.length? asks.reduce((a,b)=>a[1]>b[1]?a:b)[0]:0;
    return [support,resistance];
  }

  function consumeTrades(tr){
    if(!tr||!tr.length) return;
    tr.sort((a,b)=>a.id-b.id);
    if(state.lastTradeId===null){ state.lastTradeId=tr.at(-1).id; return; }
    let buy=0,sell=0;
    for(const t of tr){ if(t.id>state.lastTradeId){ const q=+t.qty; if(t.isBuyerMaker) sell+=q; else buy+=q; state.lastTradeId=t.id; }}
    state.cumBuys+=buy; state.cumSells+=sell;
    const now_s=Math.floor(Date.now()/1000);
    if(now_s!==state.lastSecondTs){ state.secBuy=buy; state.secSell=sell; state.lastSecondTs=now_s; }
    else{ state.secBuy+=buy; state.secSell+=sell; }
  }

  function maybeSignal(price,support,resistance){
    const now=Math.floor(Date.now()/1000);
    const inCD=(now-state.lastSignalTime)<state.cooldownSec;
    const diff=Math.abs(state.cumBuys-state.cumSells);
    const imb=state.cumBuys-state.cumSells;
    if(diff>=state.volThreshold && imb>0){
      if(!inCD||state.currentSignal!=='ğŸŸ¢ Ø´Ø±Ø§Ø¡ 100%'){
        state.currentSignal='ğŸŸ¢ Ø´Ø±Ø§Ø¡ 100%';
        state.currentTxt=`Ø¶ØºØ· Ø´Ø±Ø§Ø¡ Ù‚ÙˆÙŠ â†’ Ù‡Ø¯Ù Ø£ÙˆÙ„ ~ ${(resistance||price*1.01).toFixed(2)}$`;
        state.lastSignalTime=now;
      }
      return;
    }
    if(diff>=state.volThreshold && imb<0){
      if(!inCD||state.currentSignal!=='ğŸ”´ Ø¨ÙŠØ¹ 100%'){
        state.currentSignal='ğŸ”´ Ø¨ÙŠØ¹ 100%';
        state.currentTxt=`Ø¶ØºØ· Ø¨ÙŠØ¹ Ù‚ÙˆÙŠ â†’ Ù‡Ø¯Ù Ø£ÙˆÙ„ ~ ${(support||price*0.99).toFixed(2)}$`;
        state.lastSignalTime=now;
      }
      return;
    }
    if(!inCD) state.currentSignal='âšª Ø§Ù†ØªØ¸Ø§Ø±';
  }

  function render(price,support,resistance){
    document.getElementById('now').textContent=new Date().toLocaleString('ar');
    document.getElementById('requests').textContent=state.requestCount;
    document.getElementById('price').textContent='$'+fp(price);
    const ch=price-state.prevPrice;
    document.getElementById('price-change').textContent=`${ch>=0?'â–²':'â–¼'} ${ch.toFixed(2)}`;
    document.getElementById('support').textContent=support?'$'+fp(support):'--';
    document.getElementById('resistance').textContent=resistance?'$'+fp(resistance):'--';
    document.getElementById('signal').textContent=state.currentSignal;
    document.getElementById('signal-txt').textContent=state.currentTxt;
    document.getElementById('cum-buys').textContent=f(state.cumBuys);
    document.getElementById('cum-sells').textContent=f(state.cumSells);
    document.getElementById('cum-diff').textContent=f(state.cumBuys-state.cumSells);
    document.getElementById('sec-buy').textContent=f(state.secBuy);
    document.getElementById('sec-sell').textContent=f(state.secSell);
    document.getElementById('sec-diff').textContent=f(state.secBuy-state.secSell);
  }

  async function tick(){
    state.volThreshold=+document.getElementById('vol-threshold').value;
    state.cooldownSec=+document.getElementById('cooldown').value;
    const t=await fetchJson(API.ticker); if(!t) return;
    const ob=await fetchJson(API.depth);
    const tr=await fetchJson(API.trades);
    const price=+t.lastPrice;
    if(!state.prevPrice) state.prevPrice=price;
    const [s,r]=supportRes(ob);
    consumeTrades(tr);
    maybeSignal(price,s,r);
    render(price,s,r);
    state.prevPrice=price;
  }

  setInterval(()=>{ tick(); saveState(); },1000);
  tick();
  </script></body>
</html>
<footer class="mt-6 text-center text-xs opacity-70">Ø¨ÙÙ†ÙŠØª Ø¨Ø³Ø±Ø¹Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¨Ø§ÙŠØ«ÙˆÙ† Ø¥Ù„Ù‰ ÙˆØ§Ø¬Ù‡Ø© ÙˆÙŠØ¨ â€” EagleEye OneShot (Prototype)</footer>

  </div>  <script>
  // ====== Ø­ÙØ¸ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ù† localStorage ======
  function saveState(){ localStorage.setItem('eagle_state', JSON.stringify(state)); }
  function loadState(){ const s = localStorage.getItem('eagle_state'); if(s){ try{ Object.assign(state, JSON.parse(s)); }catch(e){} } }
  loadState();
  /* ======== Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¹Ù…ÙŠÙ„ â€” ÙŠÙØ­Ø§ÙƒÙŠ Ø³Ù„ÙˆÙƒ Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø£ØµÙ„ÙŠ ======== */
  const API = {
    ticker: 'https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT',
    depth:  'https://api.binance.com/api/v3/depth?symbol=BTCUSDT&limit=50',
    trades: 'https://api.binance.com/api/v3/trades?symbol=BTCUSDT&limit=100'
  };

  let state = {
    prevPrice: 0.0,
    cumBuys: 0.0,
    cumSells: 0.0,
    lastTradeId: null,
    secBuy: 0.0,
    secSell: 0.0,
    lastSecondTs: 0,
    requestCount: 0,
    volThreshold: 10.0,
    cooldownSec: 20,
    lastSignalTime: 0,
    currentSignal: 'âšª Ø§Ù†ØªØ¸Ø§Ø±',
    currentTxt: 'Ø§Ù„Ø³ÙˆÙ‚ Ù‡Ø§Ø¯Ø¦ØŒ Ù†Ù†ØªØ¸Ø± ØªÙØ§ÙˆØª ÙÙŠ Ø§Ù„ÙƒÙ…ÙŠØ©'
  };

  function formatPrice(x){ return typeof x==='number' ? x.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2}) : x }
  function nowStr(){ return new Date().toLocaleString('ar-EG'); }

  async function fetchJson(url){
    try{
      const r = await fetch(url);
      if(!r.ok) throw new Error(r.statusText);
      state.requestCount++;
      return await r.json();
    }catch(e){
      console.warn('fetch error',e);
      return null;
    }
  }

  function supportResistanceFromBook(ob){
    try{
      const bids = (ob.bids||[]).map(b=>[parseFloat(b[0]),parseFloat(b[1])]);
      const asks = (ob.asks||[]).map(a=>[parseFloat(a[0]),parseFloat(a[1])]);
      const support = bids.length? bids.reduce((a,b)=> a[1]>b[1]?a:b)[0] : 0;
      const resistance = asks.length? asks.reduce((a,b)=> a[1]>b[1]?a:b)[0] : 0;
      return [support,resistance];
    }catch(e){ return [0,0]; }
  }

  function consumeNewTrades(trades){
    if(!trades || !trades.length) return [0,0,null,null];
    trades.sort((a,b)=>a.id-b.id);
    if(state.lastTradeId===null){ state.lastTradeId = trades[trades.length-1].id; return [0,0,null,null]; }
    let buy=0,sell=0,first=null,last=null;
    for(const t of trades){ if(t.id>state.lastTradeId){ const q=parseFloat(t.qty); if(t.isBuyerMaker) sell+=q; else buy+=q; if(first===null) first=t.id; last=t.id; }}
    if(last!==null) state.lastTradeId = last;
    state.cumBuys += buy; state.cumSells += sell;
    const now = Math.floor(Date.now()/1000);
    if(now !== state.lastSecondTs){ state.secBuy = buy; state.secSell = sell; state.lastSecondTs = now; } else { state.secBuy += buy; state.secSell += sell; }
    return [buy,sell,first,last];
  }

  function maybeFireSignal(price,support,resistance){
    const now = Math.floor(Date.now()/1000);
    const inCooldown = (now - state.lastSignalTime) < state.cooldownSec;
    const cumDiff = Math.abs(state.cumBuys - state.cumSells);
    const cumImb = state.cumBuys - state.cumSells;
    if(cumDiff >= state.volThreshold && cumImb > 0){
      if(!inCooldown || state.currentSignal !== 'ğŸŸ¢ Ø´Ø±Ø§Ø¡ 100%'){
        const target = resistance>0? resistance : price*1.01;
        state.currentSignal = 'ğŸŸ¢ Ø´Ø±Ø§Ø¡ 100%';
        state.currentTxt = `ØªÙÙˆÙ‚ ØªØ±Ø§ÙƒÙ…ÙŠ ÙÙŠ ÙƒÙ…ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡ â†’ Ù‡Ø¯Ù Ø£ÙˆÙ„ ~ ${target.toFixed(2)}$`;
        state.lastSignalTime = now;
      }
      return;
    }
    if(cumDiff >= state.volThreshold && cumImb < 0){
      if(!inCooldown || state.currentSignal !== 'ğŸ”´ Ø¨ÙŠØ¹ 100%'){
        const target = support>0? support : price*0.99;
        state.currentSignal = 'ğŸ”´ Ø¨ÙŠØ¹ 100%';
        state.currentTxt = `ØªÙÙˆÙ‚ ØªØ±Ø§ÙƒÙ…ÙŠ ÙÙŠ ÙƒÙ…ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹ â†’ Ù‡Ø¯Ù Ø£ÙˆÙ„ ~ ${target.toFixed(2)}$`;
        state.lastSignalTime = now;
      }
      return;
    }
    if(!inCooldown && !state.currentSignal.startsWith('âšª')){
      state.currentSignal = 'âšª Ø§Ù†ØªØ¸Ø§Ø±';
      state.currentTxt = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙØ§ÙˆØª ÙˆØ§Ø¶Ø­ ÙÙŠ Ø§Ù„ÙƒÙ…ÙŠØ©. Ù†Ù†ØªØ¸Ø± ÙØ±Ù‚Ù‹Ø§ ÙŠØ¨Ù„Øº '+state.volThreshold+'+ BTC.';
    }
  }

  function render(price,support,resistance){
    document.getElementById('now').textContent = nowStr();
    document.getElementById('requests').textContent = state.requestCount;
    document.getElementById('price').textContent = '$' + formatPrice(price);
    const change = price - state.prevPrice;
    const changePercent = state.prevPrice? (change/state.prevPrice*100):0;
    const chEl = document.getElementById('price-change');
    chEl.textContent = `${change>=0? 'â–²':'â–¼'} ${Math.abs(change).toFixed(2)} (${Math.abs(changePercent).toFixed(2)}%)`;
    document.getElementById('support').textContent = support? '$'+formatPrice(support):'--';
    document.getElementById('resistance').textContent = resistance? '$'+formatPrice(resistance):'--';
    const sigEl = document.getElementById('signal'); sigEl.textContent = state.currentSignal;
    document.getElementById('signal-txt').textContent = state.currentTxt;
    document.getElementById('cum-buys').textContent = state.cumBuys.toFixed(4);
    document.getElementById('cum-sells').textContent = state.cumSells.toFixed(4);
    document.getElementById('cum-diff').textContent = (state.cumBuys - state.cumSells).toFixed(4);
    document.getElementById('sec-buy').textContent = state.secBuy.toFixed(4);
    document.getElementById('sec-sell').textContent = state.secSell.toFixed(4);
    document.getElementById('sec-diff').textContent = (state.secBuy - state.secSell).toFixed(4);
  }

  async function tick(){
    // read UI inputs
    const thresh = parseFloat(document.getElementById('vol-threshold').value||'10');
    const cooldown = parseInt(document.getElementById('cooldown').value||'20');
    state.volThreshold = isFinite(thresh)? thresh: state.volThreshold;
    state.cooldownSec = isFinite(cooldown)? cooldown: state.cooldownSec;

    const ticker = await fetchJson(API.ticker);
    if(!ticker) return;
    const orderBook = await fetchJson(API.depth);
    const trades = await fetchJson(API.trades);

    const price = parseFloat(ticker.lastPrice || 0);
    if(!state.prevPrice) state.prevPrice = price;
    const [support,resistance] = orderBook? supportResistanceFromBook(orderBook) : [0,0];
    consumeNewTrades(trades);
    maybeFireSignal(price,support,resistance);
    render(price,support,resistance);
    state.prevPrice = price;
  }

  // start loop
  setInterval(tick, 1000);
  setInterval(saveState, 1000);
  // also run immediately
  tick();

  </script></body>
</html>
