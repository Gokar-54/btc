<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ù†Ø¸Ø§Ù… Ø¹ÙŠÙ† Ø§Ù„Ù†Ø³Ø± â€” Eagle Eye Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { background: #020617; color:white; font-family: sans-serif; }
  .glass { background: rgba(255,255,255,0.06); backdrop-filter: blur(8px); border:1px solid rgba(255,255,255,0.08); }
  .counter-box { transition: 0.3s; }
  .counter-box:hover { transform: scale(1.03); }
  .center-screen { display:flex; justify-content:center; align-items:center; height:100vh; }
  input { background:#111827; border:1px solid #333; padding:0.5rem; border-radius:0.5rem; color:white; }
  button { background:#0ea5e9; color:white; padding:0.5rem 1rem; border-radius:0.5rem; font-weight:bold; transition:0.3s; }
  button:hover { background:#0284c7; }
</style>
</head>
<body>

<div id="login-page" class="center-screen">
  <div class="glass p-8 rounded-2xl w-80 text-center">
    <img src="https://img.icons8.com/?size=512&id=108556&format=png" class="w-20 mx-auto mb-4" />
    <h2 class="text-2xl font-bold mb-4">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <input id="login-username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" class="w-full mb-2"/><br>
    <input id="login-password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full mb-4"/><br>
    <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
    <p class="mt-3 text-xs opacity-70">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a href="#" onclick="showRegister()">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</a></p>
  </div>
</div>

<div id="register-page" class="center-screen" style="display:none;">
  <div class="glass p-8 rounded-2xl w-80 text-center">
    <img src="https://img.icons8.com/?size=512&id=108556&format=png" class="w-20 mx-auto mb-4" />
    <h2 class="text-2xl font-bold mb-4">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h2>
    <input id="reg-username" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" class="w-full mb-2"/><br>
    <input id="reg-password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" class="w-full mb-2"/><br>
    <button onclick="register()">Ø¥Ù†Ø´Ø§Ø¡</button>
    <p class="mt-3 text-xs opacity-70">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ <a href="#" onclick="showLogin()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a></p>
  </div>
</div>

<div id="dashboard-page" style="display:none;">
  <div class="max-w-7xl mx-auto p-6">

    <!-- HEADER -->
    <div class="glass p-5 rounded-xl flex items-center gap-4 mb-6 justify-between">
      <div class="flex items-center gap-4">
        <img src="https://img.icons8.com/?size=512&id=108556&format=png" class="w-24 drop-shadow-2xl" />
        <div>
          <div class="text-4xl font-extrabold text-cyan-300 drop-shadow">EAGLE EYE SYSTEM</div>
          <div class="text-sm opacity-70 mt-1">Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø­ÙŠØ© â€” BTC/USDT â€” Ù†Ø³Ø®Ø© ÙˆÙŠØ¨ Ù…Ø·ÙˆÙ‘Ø±Ø©</div>
        </div>
      </div>
      <button onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>

    <!-- MAIN GRID -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

      <!-- LEFT MAIN -->
      <div class="col-span-2 glass p-6 rounded-2xl">
        <div class="flex justify-between items-start">
          <div>
            <h2 class="text-xl opacity-70">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</h2>
            <div id="price" class="text-5xl font-extrabold text-cyan-300 mt-2">--</div>
            <div id="price-change" class="text-lg mt-1 opacity-80"></div>
          </div>
          <div class="text-right text-sm opacity-80">
            <div>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø¢Ù†</div>
            <div id="now" class="font-semibold mt-1">--</div>
            <div class="mt-3">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: <span id="requests">0</span></div>
          </div>
        </div>

        <hr class="my-5 border-gray-700" />

        <!-- SUPPORT & RES -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <div class="glass p-4 rounded-xl counter-box text-center">
            <div class="text-xs opacity-70">Ø§Ù„Ø¯Ø¹Ù…</div>
            <div id="support" class="text-2xl font-bold text-green-300">--</div>
          </div>
          <div class="glass p-4 rounded-xl counter-box text-center">
            <div class="text-xs opacity-70">Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø©</div>
            <div id="resistance" class="text-2xl font-bold text-red-300">--</div>
          </div>
          <div class="glass p-4 rounded-xl counter-box text-center">
            <div class="text-xs opacity-70">Ø§Ù„Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</div>
            <div id="signal" class="text-2xl font-bold text-yellow-300">âšª Ø§Ù†ØªØ¸Ø§Ø±</div>
            <div id="signal-txt" class="text-xs opacity-80 mt-1"></div>
          </div>
        </div>

        <hr class="my-5 border-gray-700" />

        <!-- CUMULATIVE -->
        <h3 class="font-semibold text-lg mb-3">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ±Ø§ÙƒÙ…</h3>
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <div class="glass p-4 rounded-xl counter-box text-center">
            <div class="text-xs opacity-70">Ø´Ø±Ø§Ø¡ ØªØ±Ø§ÙƒÙ…ÙŠ (BTC)</div>
            <div id="cum-buys" class="text-2xl font-bold text-green-300">0.0000</div>
          </div>
          <div class="glass p-4 rounded-xl counter-box text-center">
            <div class="text-xs opacity-70">Ø¨ÙŠØ¹ ØªØ±Ø§ÙƒÙ…ÙŠ (BTC)</div>
            <div id="cum-sells" class="text-2xl font-bold text-red-300">0.0000</div>
          </div>
          <div class="glass p-4 rounded-xl counter-box text-center">
            <div class="text-xs opacity-70">Ø§Ù„ÙØ±Ù‚ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ</div>
            <div id="cum-diff" class="text-2xl font-bold text-cyan-300">0.0000</div>
          </div>
        </div>

      </div>

      <!-- RIGHT PANEL -->
      <div class="glass p-6 rounded-2xl">
        <h3 class="font-semibold text-lg">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø«Ø§Ù†ÙŠØ©</h3>
        <div class="mt-4 text-sm">
          <div>Ø´Ø±Ø§Ø¡ / Ø«Ø§Ù†ÙŠØ©: <span id="sec-buy" class="text-green-300">0.0000</span></div>
          <div>Ø¨ÙŠØ¹ / Ø«Ø§Ù†ÙŠØ©: <span id="sec-sell" class="text-red-300">0.0000</span></div>
          <div class="mt-2">Ø§Ù„ÙØ±Ù‚: <span id="sec-diff" class="text-cyan-300">0.0000</span></div>
        </div>
        <hr class="my-5 border-gray-700" />
        <h3 class="font-semibold mb-2">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
        <div class="text-xs opacity-80">
          Ø¹ØªØ¨Ø© Ø§Ù„ØªÙØ§ÙˆØª: <input id="vol-threshold" class="w-20 text-black rounded px-1" value="10"> BTC<br>
          ÙˆÙ‚Øª Ø§Ù„ØªØ¨Ø±ÙŠØ¯ (Ø«): <input id="cooldown" class="w-20 text-black rounded px-1 mt-2" value="20">
        </div>
      </div>

    </div>

    <footer class="mt-10 text-center text-xs opacity-60">Eagle Eye Dashboard â€” ØªÙ… Ø§Ù„ØªØµÙ…ÙŠÙ… Ø®ØµÙŠØµÙ‹Ø§ Ù„Ùƒ</footer>
  </div>
</div>

<script>
/* ====== LOGIN & REGISTER SYSTEM SIMPLE ===== */
function showLogin(){ document.getElementById('login-page').style.display='flex'; document.getElementById('register-page').style.display='none'; }
function showRegister(){ document.getElementById('login-page').style.display='none'; document.getElementById('register-page').style.display='flex'; }

function register(){
  const u=document.getElementById('reg-username').value.trim();
  const p=document.getElementById('reg-password').value;
  if(!u||!p){ alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„'); return; }
  let users=JSON.parse(localStorage.getItem('users')||'{}');
  if(users[u]){ alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯'); return; }
  users[u]=p;
  localStorage.setItem('users', JSON.stringify(users));
  alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨!');
  showLogin();
}

function login(){
  const u=document.getElementById('login-username').value.trim();
  const p=document.getElementById('login-password').value;
  let users=JSON.parse(localStorage.getItem('users')||'{}');
  if(users[u] && users[u]===p){ 
    localStorage.setItem('currentUser', u);
    document.getElementById('login-page').style.display='none';
    document.getElementById('dashboard-page').style.display='block';
  } else alert('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©');
}

function logout(){
  localStorage.removeItem('currentUser');
  document.getElementById('dashboard-page').style.display='none';
  showLogin();
}

/* ====== LOCAL STORAGE PERSISTENCE DASHBOARD ===== */
let saved = localStorage.getItem('eagle_state');
let state = saved ? JSON.parse(saved) : {};
state = {
  prevPrice: state.prevPrice ?? 0,
  cumBuys: state.cumBuys ?? 0,
  cumSells: state.cumSells ?? 0,
  lastTradeId: state.lastTradeId ?? null,
  secBuy: state.secBuy ?? 0,
  secSell: state.secSell ?? 0,
  lastSecondTs: state.lastSecondTs ?? 0,
  requestCount: state.requestCount ?? 0,
  volThreshold: state.volThreshold ?? 3,
  cooldownSec: state.cooldownSec ?? 10,
  lastSignalTime: state.lastSignalTime ?? 0,
  currentSignal: state.currentSignal ?? 'âšª Ø§Ù†ØªØ¸Ø§Ø±',
  currentTxt: state.currentTxt ?? ''
};

function saveState(){ localStorage.setItem('eagle_state', JSON.stringify(state)); }

const API={ ticker:'https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT', depth:'https://api.binance.com/api/v3/depth?symbol=BTCUSDT&limit=50', trades:'https://api.binance.com/api/v3/trades?symbol=BTCUSDT&limit=100'};

function f(x){return Number(x).toFixed(4)}
function fp(x){return Number(x).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2})}

async function fetchJson(url){ try{const r=await fetch(url); if(!r.ok) throw 0; state.requestCount++; return r.json();}catch{return null;} }

function supportRes(ob){
  const bids=(ob?.bids||[]).map(b=>[+b[0],+b[1]]);
  const asks=(ob?.asks||[]).map(a=>[+a[0],+a[1]]);
  const support=bids.length? bids.reduce((a,b)=>a[1]>b[1]?a:b)[0]:0;
  const resistance=asks.length? asks.reduce((a,b)=>a[1]>b[1]?a:b)[0]:0;
  return [support,resistance];
}

function consumeTrades(tr){
  if(!tr||!tr.length) return;
  tr.sort((a,b)=>a.id-b.id);
  if(state.lastTradeId===null){ state.lastTradeId=tr.at(-1).id; return; }
  let buy=0,sell=0;
  for(const t of tr){ if(t.id>state.lastTradeId){ const q=+t.qty; if(t.isBuyerMaker) sell+=q; else buy+=q; state.lastTradeId=t.id; }}
  state.cumBuys+=buy; state.cumSells+=sell;
  const now_s=Math.floor(Date.now()/1000);
  if(now_s!==state.lastSecondTs){ state.secBuy=buy; state.secSell=sell; state.lastSecondTs=now_s; }
  else{ state.secBuy+=buy; state.secSell+=sell; }
}

function maybeSignal(price,support,resistance){
  const now=Math.floor(Date.now()/1000);
  const inCD=(now-state.lastSignalTime)<state.cooldownSec;
  const diff=Math.abs(state.cumBuys-state.cumSells);
  const imb=state.cumBuys-state.cumSells;
  if(diff>=state.volThreshold && imb>0){
    if(!inCD||state.currentSignal!=='ğŸŸ¢ Ø´Ø±Ø§Ø¡ 100%'){
      state.currentSignal='ğŸŸ¢ Ø´Ø±Ø§Ø¡ 100%';
      state.currentTxt=`Ø¶ØºØ· Ø´Ø±Ø§Ø¡ Ù‚ÙˆÙŠ â†’ Ù‡Ø¯Ù Ø£ÙˆÙ„ ~ ${(resistance||price*1.01).toFixed(2)}$`;
      state.lastSignalTime=now;
    }
    return;
  }
  if(diff>=state.volThreshold && imb<0){
    if(!inCD||state.currentSignal!=='ğŸ”´ Ø¨ÙŠØ¹ 100%'){
      state.currentSignal='ğŸ”´ Ø¨ÙŠØ¹ 100%';
      state.currentTxt=`Ø¶ØºØ· Ø¨ÙŠØ¹ Ù‚ÙˆÙŠ â†’ Ù‡Ø¯Ù Ø£ÙˆÙ„ ~ ${(support||price*0.99).toFixed(2)}$`;
      state.lastSignalTime=now;
    }
    return;
  }
  if(!inCD) state.currentSignal='âšª Ø§Ù†ØªØ¸Ø§Ø±';
}

function render(price,support,resistance){
  document.getElementById('now').textContent=new Date().toLocaleString('ar');
  document.getElementById('requests').textContent=state.requestCount;
  document.getElementById('price').textContent='$'+fp(price);
  const ch=price-state.prevPrice;
  document.getElementById('price-change').textContent=`${ch>=0?'â–²':'â–¼'} ${ch.toFixed(2)}`;
  document.getElementById('support').textContent=support?'$'+fp(support):'--';
  document.getElementById('resistance').textContent=resistance?'$'+fp(resistance):'--';
  document.getElementById('signal').textContent=state.currentSignal;
  document.getElementById('signal-txt').textContent=state.currentTxt;
  document.getElementById('cum-buys').textContent=f(state.cumBuys);
  document.getElementById('cum-sells').textContent=f(state.cumSells);
  document.getElementById('cum-diff').textContent=f(state.cumBuys-state.cumSells);
  document.getElementById('sec-buy').textContent=f(state.secBuy);
  document.getElementById('sec-sell').textContent=f(state.secSell);
  document.getElementById('sec-diff').textContent=f(state.secBuy-state.secSell);
}

async function tick(){
  state.volThreshold=+document.getElementById('vol-threshold').value;
  state.cooldownSec=+document.getElementById('cooldown').value;
  const t=await fetchJson(API.ticker); if(!t) return;
  const ob=await fetchJson(API.depth);
  const tr=await fetchJson(API.trades);
  const price=+t.lastPrice;
  if(!state.prevPrice) state.prevPrice=price;
  const [s,r]=supportRes(ob);
  consumeTrades(tr);
  maybeSignal(price,s,r);
  render(price,s,r);
  state.prevPrice=price;
}

setInterval(()=>{ tick(); saveState(); },1000);
tick();
</script>
</body>
</html>
