<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù†Ø¸Ø§Ù… Ø¹ÙŠÙ† Ø§Ù„Ù†Ø³Ø± â€” Eagle Eye</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background:#020617; color:white; font-family:system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial; }
    .glass{background:rgba(255,255,255,0.04);backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,0.06);}    
    .counter-box { transition:0.18s; }
    .counter-box:hover { transform:translateY(-4px); }
    input{background:#0b1220;border:1px solid #233047;padding:.5rem;border-radius:.5rem;color:#dbeafe}
    .btn{background:#06b6d4;color:#021124;padding:.45rem .8rem;border-radius:.5rem;font-weight:700}
    .btn:hover{opacity:.95}
    .signal-strong{padding:.6rem 1rem;border-radius:12px;font-weight:800}
    .error-message { color: #ef4444; font-size: 0.875rem; margin-top: 0.5rem; }
  </style>
</head>
<body class="min-h-screen p-6">
<!-- ========== AUTH (Login) ========== -->
<div id="auth-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-black/60">
  <div class="w-full max-w-xl glass p-6 rounded-2xl">
    <div class="flex items-center gap-4">
      <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><g fill='%2306b6d4'><path d='M32 2l8 18h18l-14 10 6 18L32 36 6 48l6-18L-2 20h18z'/></g></svg>" alt="eagle" class="w-20"/>
      <div>
        <div class="text-2xl font-extrabold text-cyan-300">EAGLE EYE SYSTEM</div>
        <div class="text-sm opacity-80">Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ø¸Ø§Ù…</div>
      </div>
    </div>
    
    <div class="mt-6">
      <div id="login-form">
        <input id="login-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…ÙˆØ­Ø¯Ø©" type="password" class="w-full mb-3" />
        <div id="error-message" class="error-message hidden"></div>
        <div class="flex gap-3">
          <button id="btn-login" class="btn">Ø¯Ø®ÙˆÙ„</button>
          <button id="btn-demo" class="py-2 px-3 rounded bg-white/5">ØªØ¬Ø±Ø¨Ø© Ø³Ø±ÙŠØ¹Ø©</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ========== DASHBOARD ========== -->
<div id="dashboard" style="display:none" class="max-w-7xl mx-auto">
  <!-- header -->
  <div class="flex items-center gap-4 mb-6">
    <img id="header-logo" src="https://img.icons8.com/?size=512&id=108556&format=png" class="w-20"/>
    <div>
      <div class="text-3xl font-extrabold text-cyan-300">EAGLE EYE SYSTEM</div>
      <div class="text-sm opacity-70">Ù„ÙˆØ­Ø© Ø­ÙŠØ© â€” <span id="current-symbol">BTC/USDT</span> â€” <span class="ml-3 text-yellow-300 font-semibold">PAXG</span></div>
    </div>
    <div class="mr-auto flex items-center gap-3">
      <label class="text-sm opacity-80">Ø±Ù…Ø²:</label>
      <select id="symbol-select" class="text-black p-1 rounded">
        <option value="BTCUSDT">BTC/USDT</option>
        <option value="PAXGUSDT">PAXG/USDT</option>
      </select>
    </div>
    <div class="flex items-center gap-3">
      <button id="logout" class="btn">Ø®Ø±ÙˆØ¬</button>
    </div>
  </div>
  
  <!-- SIGNAL BANNER -->
  <div id="signal-banner" class="mb-4"></div>
  
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="md:col-span-2 glass p-6 rounded-2xl">
      <div class="flex justify-between items-start">
        <div>
          <h2 class="text-lg opacity-80">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</h2>
          <div id="price" class="text-4xl font-extrabold text-cyan-300 mt-2">--</div>
          <div id="price-change" class="mt-1 opacity-80"></div>
        </div>
        <div class="text-right text-sm opacity-80">
          <div>Ø§Ù„ÙˆÙ‚Øª</div>
          <div id="now" class="font-semibold mt-1">--</div>
          <div class="mt-2">Ø·Ù„Ø¨Ø§Øª: <span id="requests">0</span></div>
        </div>
      </div>
      
      <hr class="my-4 border-white/6" />

      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <div class="glass p-4 rounded-xl text-center">
          <div class="text-xs opacity-70">Ø§Ù„Ø¯Ø¹Ù…</div>
          <div id="support" class="text-2xl font-bold text-green-300">--</div>
        </div>
        <div class="glass p-4 rounded-xl text-center">
          <div class="text-xs opacity-70">Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø©</div>
          <div id="resistance" class="text-2xl font-bold text-red-300">--</div>
        </div>
        <div class="glass p-4 rounded-xl text-center">
          <div class="text-xs opacity-70">Ø§Ù„Ø¥Ø´Ø§Ø±Ø©</div>
          <div id="signal" class="text-2xl font-bold text-yellow-300">âšª Ø§Ù†ØªØ¸Ø§Ø±</div>
          <div id="signal-txt" class="text-xs opacity-80 mt-1"></div>
        </div>
      </div>

      <hr class="my-4 border-white/6" />

      <h3 class="font-semibold mb-2">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªØ±Ø§ÙƒÙ…</h3>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <div class="glass p-4 rounded-xl text-center counter-box">
          <div class="text-xs opacity-70">Ø´Ø±Ø§Ø¡ ØªØ±Ø§ÙƒÙ…ÙŠ</div>
          <div id="cum-buys" class="text-2xl font-bold text-green-300">0.0000</div>
        </div>
        <div class="glass p-4 rounded-xl text-center counter-box">
          <div class="text-xs opacity-70">Ø¨ÙŠØ¹ ØªØ±Ø§ÙƒÙ…ÙŠ</div>
          <div id="cum-sells" class="text-2xl font-bold text-red-300">0.0000</div>
        </div>
        <div class="glass p-4 rounded-xl text-center counter-box">
          <div class="text-xs opacity-70">Ø§Ù„ÙØ±Ù‚</div>
          <div id="cum-diff" class="text-2xl font-bold text-cyan-300">0.0000</div>
        </div>
      </div>
    </div>

    <div class="glass p-6 rounded-2xl">
      <h3 class="font-semibold">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø«Ø§Ù†ÙŠØ©</h3>
      <div class="mt-4 text-sm">
        <div>Ø´Ø±Ø§Ø¡ / Ø«Ø§Ù†ÙŠØ©: <span id="sec-buy" class="text-green-300">0.0000</span></div>
        <div>Ø¨ÙŠØ¹ / Ø«Ø§Ù†ÙŠØ©: <span id="sec-sell" class="text-red-300">0.0000</span></div>
        <div class="mt-2">Ø§Ù„ÙØ±Ù‚: <span id="sec-diff" class="text-cyan-300">0.0000</span></div>
      </div>

      <hr class="my-4 border-white/6" />
      <div class="text-xs opacity-80"> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        <div class="mt-2">
          Ø¹ØªØ¨Ø© Ø§Ù„ØªÙØ§ÙˆØª: <input id="vol-threshold" class="w-20 text-black rounded px-1" value="10"> BTC<br>
          ÙˆÙ‚Øª Ø§Ù„ØªØ¨Ø±ÙŠØ¯ (Ø«): <input id="cooldown" class="w-20 text-black rounded px-1 mt-2" value="20">
        </div>
      </div>
    </div>
  </div>
  
  <footer class="mt-8 text-center text-xs opacity-60">Eagle Eye â€” PAXG & BTC monitor</footer>
</div>

<script>
// ======== Authentication ========
const PASSWORD = "eagle2024"; // ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ù…ÙˆØ­Ø¯Ø© Ù„Ù„Ù†Ø¸Ø§Ù…

// ======== State persistence ========
const GLOBAL_STATE_KEY = 'eagle_global_state_v3';

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ù…Ù† localStorage
function loadGlobalState() {
  const saved = JSON.parse(localStorage.getItem(GLOBAL_STATE_KEY) || 'null');
  
  if (!saved) {
    // Ø­Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ø°Ø§ Ù„Ù… ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø©
    return {
      prevPrice: 0,
      cumBuys: 0,
      cumSells: 0,
      lastTradeId: null,
      secBuy: 0,
      secSell: 0,
      lastSecondTs: 0,
      requestCount: 0,
      volThreshold: 10,
      cooldownSec: 20,
      lastSignalTime: 0,
      currentSignal: 'âšª Ø§Ù†ØªØ¸Ø§Ø±',
      currentTxt: '',
      initializedAt: new Date().toISOString()
    };
  }
  
  return saved;
}

let state = loadGlobalState();

// Ø­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø© ÙÙŠ localStorage
function saveGlobalState() {
  localStorage.setItem(GLOBAL_STATE_KEY, JSON.stringify(state));
}

// ======== Authentication Handlers ========
document.getElementById('btn-login').onclick = () => {
  const p = document.getElementById('login-pass').value;
  const errorElement = document.getElementById('error-message');
  
  if (p === PASSWORD) {
    document.getElementById('auth-screen').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';
    startMonitor();
    errorElement.classList.add('hidden');
  } else {
    errorElement.textContent = 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©';
    errorElement.classList.remove('hidden');
  }
};

document.getElementById('btn-demo').onclick = () => {
  // ØªØ¬Ø±Ø¨Ø© Ø³Ø±ÙŠØ¹Ø© - Ù„Ø§ ØªØ­ØªØ§Ø¬ ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± ÙˆÙ„ÙƒÙ†Ù‡Ø§ Ù‚Ø¯ Ù„Ø§ ØªØ¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
  document.getElementById('auth-screen').style.display = 'none';
  document.getElementById('dashboard').style.display = 'block';
  startMonitor();
};

document.getElementById('logout').onclick = () => {
  document.getElementById('auth-screen').style.display = 'flex';
  document.getElementById('dashboard').style.display = 'none';
  document.getElementById('login-pass').value = '';
};

// ======== API & helpers ========
let currentSymbol = 'BTCUSDT';

function fp(x){ return Number(x).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2}); }
function f4(x){ return Number(x).toFixed(4); }

async function fetchJson(url){ 
  try{ 
    const r = await fetch(url); 
    if(!r.ok) throw new Error('Network error'); 
    state.requestCount++; 
    return await r.json(); 
  } catch(e){ 
    console.error('API Error:', e);
    return null; 
  } 
}

function supportRes(orderBook){
  try{
    const bids = (orderBook.bids||[]).map(b=>[+b[0],+b[1]]);
    const asks = (orderBook.asks||[]).map(a=>[+a[0],+a[1]]);
    const support = bids.length? bids.reduce((a,b)=> a[1]>b[1]?a:b)[0] : 0;
    const resistance = asks.length? asks.reduce((a,b)=> a[1]>b[1]?a:b)[0] : 0;
    return [support,resistance];
  }catch(e){ 
    console.error('Error calculating support/resistance:', e);
    return [0,0]; 
  }
}

function consumeTrades(trades){
  if(!trades || !trades.length) return [0,0];
  
  // ØªØ±ØªÙŠØ¨ Ø§Ù„ØµÙÙ‚Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ø¹Ø±Ù
  trades.sort((a,b)=>a.id-b.id);
  
  // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ø°Ù‡ Ù‡ÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ØŒ Ø­ÙØ¸ Ø¢Ø®Ø± Ù…Ø¹Ø±Ù ÙˆØ¹Ø¯Ù… Ø­Ø³Ø§Ø¨ Ø£ÙŠ Ø´ÙŠØ¡
  if(state.lastTradeId===null){ 
    state.lastTradeId = trades.at(-1).id; 
    return [0,0]; 
  }
  
  let buy = 0, sell = 0, first = null, last = null;
  
  // Ø­Ø³Ø§Ø¨ Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙÙ‚Ø·
  for(const t of trades){ 
    if(t.id > state.lastTradeId){ 
      const q = +t.qty; 
      if(t.isBuyerMaker) 
        sell += q; 
      else 
        buy += q; 
      
      if(first === null) first = t.id;
      last = t.id;
    }
  }
  
  if(last !== null) state.lastTradeId = last;
  state.cumBuys += buy;
  state.cumSells += sell;
  
  // ØªØ­Ø¯ÙŠØ« Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø«Ø§Ù†ÙŠØ©
  const now = Math.floor(Date.now()/1000);
  if(now !== state.lastSecondTs){ 
    state.secBuy = buy; 
    state.secSell = sell; 
    state.lastSecondTs = now; 
  } else { 
    state.secBuy += buy; 
    state.secSell += sell; 
  }
  
  return [buy, sell];
}

// ======== SIGNAL LOGIC (Ø§Ù„ØªØ±Ø§ÙƒÙ… + ØªÙ‚Ø§Ø·Ø¹ Ø§Ù„Ø³Ø¹Ø± Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…/Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø©) ========
function computeSignal(price, support, resistance, prevPrice){
  // 1) ØªØ±Ø§ÙƒÙ…
  const buy = state.cumBuys; 
  const sell = state.cumSells;
  let accumSignal = 'âšª';
  if(buy > sell) accumSignal = 'ğŸŸ¢';
  else if(sell > buy) accumSignal = 'ğŸ”´';

  // 2) ØªÙ‚Ø§Ø·Ø¹ Ø§Ù„Ø³Ø¹Ø±
  let crossSignal = 'âšª';
  if(prevPrice <= resistance && price > resistance && resistance > 0) crossSignal = 'ğŸŸ¢';
  if(prevPrice >= support && price < support && support > 0) crossSignal = 'ğŸ”´';

  // 3) Ø¯Ù…Ø¬ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª
  if(accumSignal === 'ğŸŸ¢' && crossSignal === 'ğŸŸ¢') 
    return {signal:'ğŸŸ¢ Ø´Ø±Ø§Ø¡ Ù‚ÙˆÙŠ', color:'green', reason:'ØªØ±Ø§ÙƒÙ… Ùˆ Ø§Ø®ØªØ±Ø§Ù‚ Ù…Ù‚Ø§ÙˆÙ…Ø©'};
  if(accumSignal === 'ğŸ”´' && crossSignal === 'ğŸ”´') 
    return {signal:'ğŸ”´ Ø¨ÙŠØ¹ Ù‚ÙˆÙŠ', color:'red', reason:'ØªØ±Ø§ÙƒÙ… ÙˆÙƒØ³Ø± Ø¯Ø¹Ù…'};
  if(accumSignal === 'ğŸŸ¢' && crossSignal === 'âšª') 
    return {signal:'ğŸŸ¢ Ø´Ø±Ø§Ø¡', color:'green', reason:'ØªØ±Ø§ÙƒÙ… Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ø¨ÙŠØ¹'};
  if(accumSignal === 'ğŸ”´' && crossSignal === 'âšª') 
    return {signal:'ğŸ”´ Ø¨ÙŠØ¹', color:'red', reason:'ØªØ±Ø§ÙƒÙ… Ø¨ÙŠØ¹ Ø£Ø¹Ù„Ù‰'};
  if(accumSignal === 'âšª' && crossSignal === 'ğŸŸ¢') 
    return {signal:'ğŸŸ¢ Ø´Ø±Ø§Ø¡', color:'green', reason:'Ø§Ø®ØªØ±Ø§Ù‚ Ù…Ù‚Ø§ÙˆÙ…Ø©'};
  if(accumSignal === 'âšª' && crossSignal === 'ğŸ”´') 
    return {signal:'ğŸ”´ Ø¨ÙŠØ¹', color:'red', reason:'ÙƒØ³Ø± Ø¯Ø¹Ù…'};
  
  return {signal:'âšª Ø§Ù†ØªØ¸Ø§Ø±', color:'yellow', reason:'Ø´Ø±ÙˆØ· ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©'};
}

// ======== RENDER UI ========
function setSignalBanner(obj){
  const banner = document.getElementById('signal-banner');
  if(obj.signal.startsWith('ğŸŸ¢')){
    banner.innerHTML = `<div class="signal-strong bg-green-700/20 text-green-300">${obj.signal} â€” ${obj.reason}</div>`;
  } else if(obj.signal.startsWith('ğŸ”´')){
    banner.innerHTML = `<div class="signal-strong bg-red-700/20 text-red-300">${obj.signal} â€” ${obj.reason}</div>`;
  } else {
    banner.innerHTML = `<div class="signal-strong bg-yellow-700/10 text-yellow-300">${obj.signal} â€” ${obj.reason}</div>`;
  }
}

function render(price, support, resistance, prevPrice){
  document.getElementById('now').textContent = new Date().toLocaleString('ar');
  document.getElementById('requests').textContent = state.requestCount;
  document.getElementById('price').textContent = '$' + fp(price);
  
  const ch = price - (state.prevPrice || price);
  document.getElementById('price-change').textContent = `${ch>=0? 'â–²':'â–¼'} ${Math.abs(ch).toFixed(2)}`;
  document.getElementById('price-change').style.color = ch >= 0 ? '#10b981' : '#ef4444';
  
  document.getElementById('support').textContent = support ? '$'+fp(support) : '--';
  document.getElementById('resistance').textContent = resistance ? '$'+fp(resistance) : '--';
  document.getElementById('cum-buys').textContent = f4(state.cumBuys);
  document.getElementById('cum-sells').textContent = f4(state.cumSells);
  document.getElementById('cum-diff').textContent = f4(state.cumBuys - state.cumSells);
  document.getElementById('sec-buy').textContent = f4(state.secBuy);
  document.getElementById('sec-sell').textContent = f4(state.secSell);
  document.getElementById('sec-diff').textContent = f4(state.secBuy - state.secSell);

  const sig = computeSignal(price, support, resistance, prevPrice);
  document.getElementById('signal').textContent = sig.signal;
  document.getElementById('signal').style.color = sig.color === 'green' ? '#10b981' : 
                                                sig.color === 'red' ? '#ef4444' : '#f59e0b';
  document.getElementById('signal-txt').textContent = sig.reason;
  setSignalBanner(sig);
}

// ======== MAIN LOOP ========
let running = false;
let apiSymbol = 'BTCUSDT';

document.getElementById('symbol-select').onchange = (e) => { 
  apiSymbol = e.target.value; 
  document.getElementById('current-symbol').textContent = e.target.value.replace('USDT','/USDT'); 
};

async function tick(){
  // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ù† Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
  state.volThreshold = +document.getElementById('vol-threshold').value;
  state.cooldownSec = +document.getElementById('cooldown').value;

  try {
    const ticker = await fetchJson(`https://api.binance.com/api/v3/ticker/24hr?symbol=${apiSymbol}`);
    if(!ticker) {
      console.error('Failed to fetch ticker');
      return;
    }
    
    const depth = await fetchJson(`https://api.binance.com/api/v3/depth?symbol=${apiSymbol}&limit=50`);
    const trades = await fetchJson(`https://api.binance.com/api/v3/trades?symbol=${apiSymbol}&limit=100`);

    const price = +ticker.lastPrice;
    const prevPrice = state.prevPrice || price;
    if(!state.prevPrice) state.prevPrice = price;

    const [support, resistance] = depth ? supportRes(depth) : [0, 0];
    consumeTrades(trades);
    render(price, support, resistance, prevPrice);
    state.prevPrice = price;
  } catch (error) {
    console.error('Error in tick function:', error);
  }
}

function startMonitor(){ 
  if(running) return; 
  running = true; 
  tick(); 
  setInterval(() => { 
    tick(); 
    saveGlobalState(); 
  }, 1000); 
}

// Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ù„ÙØ¹Ù„
if(localStorage.getItem('eagle_global_state_v3')){ 
  document.getElementById('auth-screen').style.display = 'none'; 
  document.getElementById('dashboard').style.display = 'block'; 
  startMonitor(); 
}
</script>
</body>
</html>    <div class="glass p-4 rounded-xl text-center counter-box">
      <div class="text-xs opacity-70">Ø´Ø±Ø§Ø¡ ØªØ±Ø§ÙƒÙ…ÙŠ</div>
      <div id="cum-buys" class="text-2xl font-bold text-green-300">0.0000</div>
    </div>
    <div class="glass p-4 rounded-xl text-center counter-box">
      <div class="text-xs opacity-70">Ø¨ÙŠØ¹ ØªØ±Ø§ÙƒÙ…ÙŠ</div>
      <div id="cum-sells" class="text-2xl font-bold text-red-300">0.0000</div>
    </div>
    <div class="glass p-4 rounded-xl text-center counter-box">
      <div class="text-xs opacity-70">Ø§Ù„ÙØ±Ù‚</div>
      <div id="cum-diff" class="text-2xl font-bold text-cyan-300">0.0000</div>
    </div>
  </div>

</div>

<div class="glass p-6 rounded-2xl">
  <h3 class="font-semibold">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø«Ø§Ù†ÙŠØ©</h3>
  <div class="mt-4 text-sm">
    <div>Ø´Ø±Ø§Ø¡ / Ø«Ø§Ù†ÙŠØ©: <span id="sec-buy" class="text-green-300">0.0000</span></div>
    <div>Ø¨ÙŠØ¹ / Ø«Ø§Ù†ÙŠØ©: <span id="sec-sell" class="text-red-300">0.0000</span></div>
    <div class="mt-2">Ø§Ù„ÙØ±Ù‚: <span id="sec-diff" class="text-cyan-300">0.0000</span></div>
  </div>

  <hr class="my-4 border-white/6" />
  <div class="text-xs opacity-80"> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    <div class="mt-2">
      Ø¹ØªØ¨Ø© Ø§Ù„ØªÙØ§ÙˆØª: <input id="vol-threshold" class="w-20 text-black rounded px-1" value="10"> BTC<br>
      ÙˆÙ‚Øª Ø§Ù„ØªØ¨Ø±ÙŠØ¯ (Ø«): <input id="cooldown" class="w-20 text-black rounded px-1 mt-2" value="20">
    </div>
  </div>
</div>

  </div>  <footer class="mt-8 text-center text-xs opacity-60">Eagle Eye â€” PAXG & BTC monitor</footer>
</div><script>
// ======== Authentication ========
const usersKey = 'eagle_users_v2';
const stateKey = 'eagle_state_v2';
let users = JSON.parse(localStorage.getItem(usersKey)||'{}');

function showLogin(){ document.getElementById('login-form').style.display='block'; document.getElementById('signup-form').style.display='none'; }
function showSignup(){ document.getElementById('login-form').style.display='none'; document.getElementById('signup-form').style.display='block'; }

document.getElementById('show-login').onclick = showLogin;
document.getElementById('show-signup').onclick = showSignup;
document.getElementById('btn-back').onclick = showLogin;

document.getElementById('btn-signup').onclick = ()=>{
  const u = document.getElementById('reg-user').value.trim();
  const p = document.getElementById('reg-pass').value;
  if(!u||!p) return alert('Ø§Ù…Ù„Ø£ Ø§Ù„Ø­Ù‚ÙˆÙ„');
  if(users[u]) return alert('Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯');
  users[u]=p; localStorage.setItem(usersKey, JSON.stringify(users));
  alert('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨'); showLogin();
};

document.getElementById('btn-login').onclick = ()=>{
  const u = document.getElementById('login-user').value.trim();
  const p = document.getElementById('login-pass').value;
  if(users[u] && users[u]===p){
    localStorage.setItem('eagle_current_user', u);
    document.getElementById('auth-screen').style.display='none';
    document.getElementById('dashboard').style.display='block';
    startMonitor();
  } else alert('Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©');
};

document.getElementById('btn-demo').onclick = ()=>{
  // demo quick access
  localStorage.setItem('eagle_current_user','demo');
  document.getElementById('auth-screen').style.display='none';
  document.getElementById('dashboard').style.display='block';
  startMonitor();
}

document.getElementById('logout').onclick = ()=>{ localStorage.removeItem('eagle_current_user'); location.reload(); };

// ======== State persistence ========
let saved = JSON.parse(localStorage.getItem(stateKey)||'null');
let state = saved || {
  prevPrice:0, cumBuys:0, cumSells:0, lastTradeId:null, secBuy:0, secSell:0, lastSecondTs:0, requestCount:0, volThreshold:10, cooldownSec:20, lastSignalTime:0, currentSignal:'âšª Ø§Ù†ØªØ¸Ø§Ø±', currentTxt:''
};

function saveState(){ localStorage.setItem(stateKey, JSON.stringify(state)); }

// ======== API & helpers ========
let currentSymbol = 'BTCUSDT';
function symbolToApi(sym){ return `https://api.binance.com/api/v3/` }

function fp(x){ return Number(x).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2}); }
function f4(x){ return Number(x).toFixed(4); }

async function fetchJson(url){ try{ const r=await fetch(url); if(!r.ok) throw 0; state.requestCount++; return await r.json(); }catch(e){ return null; } }

function supportRes(orderBook){
  try{
    const bids = (orderBook.bids||[]).map(b=>[+b[0],+b[1]]);
    const asks = (orderBook.asks||[]).map(a=>[+a[0],+a[1]]);
    const support = bids.length? bids.reduce((a,b)=> a[1]>b[1]?a:b)[0] : 0;
    const resistance = asks.length? asks.reduce((a,b)=> a[1]>b[1]?a:b)[0] : 0;
    return [support,resistance];
  }catch(e){ return [0,0]; }
}

function consumeTrades(trades){
  if(!trades || !trades.length) return [0,0];
  trades.sort((a,b)=>a.id-b.id);
  if(state.lastTradeId===null){ state.lastTradeId = trades.at(-1).id; return [0,0]; }
  let buy=0,sell=0, first=null, last=null;
  for(const t of trades){ if(t.id>state.lastTradeId){ const q=+t.qty; if(t.isBuyerMaker) sell+=q; else buy+=q; if(first===null) first=t.id; last=t.id; }}
  if(last!==null) state.lastTradeId=last;
  state.cumBuys += buy; state.cumSells += sell;
  const now = Math.floor(Date.now()/1000);
  if(now !== state.lastSecondTs){ state.secBuy = buy; state.secSell = sell; state.lastSecondTs = now; } else { state.secBuy += buy; state.secSell += sell; }
  return [buy,sell];
}

// ======== SIGNAL LOGIC (Ø§Ù„ØªØ±Ø§ÙƒÙ… + ØªÙ‚Ø§Ø·Ø¹ Ø§Ù„Ø³Ø¹Ø± Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…/Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø©) ========
function computeSignal(price,support,resistance,prevPrice){
  // 1) ØªØ±Ø§ÙƒÙ…
  const buy = state.cumBuys; const sell = state.cumSells;
  let accumSignal = 'âšª';
  if(buy > sell) accumSignal = 'ğŸŸ¢';
  else if(sell > buy) accumSignal = 'ğŸ”´';

  // 2) ØªÙ‚Ø§Ø·Ø¹ Ø§Ù„Ø³Ø¹Ø±
  let crossSignal = 'âšª';
  if(prevPrice <= resistance && price > resistance && resistance>0) crossSignal = 'ğŸŸ¢';
  if(prevPrice >= support && price < support && support>0) crossSignal = 'ğŸ”´';

  // 3) Ø¯Ù…Ø¬
  if(accumSignal === 'ğŸŸ¢' && crossSignal === 'ğŸŸ¢') return {signal:'ğŸŸ¢ Ø´Ø±Ø§Ø¡ Ù‚ÙˆÙŠ', color:'green', reason:'ØªØ±Ø§ÙƒÙ… Ùˆ Ø§Ø®ØªØ±Ø§Ù‚ Ù…Ù‚Ø§ÙˆÙ…Ø©'};
  if(accumSignal === 'ğŸ”´' && crossSignal === 'ğŸ”´') return {signal:'ğŸ”´ Ø¨ÙŠØ¹ Ù‚ÙˆÙŠ', color:'red', reason:'ØªØ±Ø§ÙƒÙ… ÙˆÙƒØ³Ø± Ø¯Ø¹Ù…'};
  if(accumSignal === 'ğŸŸ¢' && crossSignal === 'âšª') return {signal:'ğŸŸ¢ Ø´Ø±Ø§Ø¡', color:'green', reason:'ØªØ±Ø§ÙƒÙ… Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ø¨ÙŠØ¹'};
  if(accumSignal === 'ğŸ”´' && crossSignal === 'âšª') return {signal:'ğŸ”´ Ø¨ÙŠØ¹', color:'red', reason:'ØªØ±Ø§ÙƒÙ… Ø¨ÙŠØ¹ Ø£Ø¹Ù„Ù‰'};
  if(accumSignal === 'âšª' && crossSignal === 'ğŸŸ¢') return {signal:'ğŸŸ¢ Ø´Ø±Ø§Ø¡', color:'green', reason:'Ø§Ø®ØªØ±Ø§Ù‚ Ù…Ù‚Ø§ÙˆÙ…Ø©'};
  if(accumSignal === 'âšª' && crossSignal === 'ğŸ”´') return {signal:'ğŸ”´ Ø¨ÙŠØ¹', color:'red', reason:'ÙƒØ³Ø± Ø¯Ø¹Ù…'};
  return {signal:'âšª Ø§Ù†ØªØ¸Ø§Ø±', color:'yellow', reason:'Ø´Ø±ÙˆØ· ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©'};
}

// ======== RENDER UI ========
function setSignalBanner(obj){
  const banner = document.getElementById('signal-banner');
  if(obj.signal.startsWith('ğŸŸ¢')){
    banner.innerHTML = `<div class="signal-strong bg-green-700/20 text-green-300">${obj.signal} â€” ${obj.reason}</div>`;
  } else if(obj.signal.startsWith('ğŸ”´')){
    banner.innerHTML = `<div class="signal-strong bg-red-700/20 text-red-300">${obj.signal} â€” ${obj.reason}</div>`;
  } else {
    banner.innerHTML = `<div class="signal-strong bg-yellow-700/10 text-yellow-300">${obj.signal} â€” ${obj.reason}</div>`;
  }
}

function render(price,support,resistance,prevPrice){
  document.getElementById('now').textContent = new Date().toLocaleString('ar');
  document.getElementById('requests').textContent = state.requestCount;
  document.getElementById('price').textContent = '$' + fp(price);
  const ch = price - (state.prevPrice||price);
  document.getElementById('price-change').textContent = `${ch>=0? 'â–²':'â–¼'} ${Math.abs(ch).toFixed(2)}`;
  document.getElementById('support').textContent = support? '$'+fp(support) : '--';
  document.getElementById('resistance').textContent = resistance? '$'+fp(resistance) : '--';
  document.getElementById('cum-buys').textContent = f4(state.cumBuys);
  document.getElementById('cum-sells').textContent = f4(state.cumSells);
  document.getElementById('cum-diff').textContent = f4(state.cumBuys - state.cumSells);
  document.getElementById('sec-buy').textContent = f4(state.secBuy);
  document.getElementById('sec-sell').textContent = f4(state.secSell);
  document.getElementById('sec-diff').textContent = f4(state.secBuy - state.secSell);

  const sig = computeSignal(price,support,resistance,prevPrice);
  document.getElementById('signal').textContent = sig.signal;
  document.getElementById('signal-txt').textContent = sig.reason;
  setSignalBanner(sig);
}

// ======== MAIN LOOP ========
let running = false;
let apiSymbol = 'BTCUSDT';

document.getElementById('symbol-select').onchange = (e)=>{ apiSymbol = e.target.value; document.getElementById('current-symbol').textContent = e.target.value.replace('USDT','/USDT'); };

async function tick(){
  // read settings
  state.volThreshold = +document.getElementById('vol-threshold').value;
  state.cooldownSec = +document.getElementById('cooldown').value;

  const ticker = await fetchJson(`https://api.binance.com/api/v3/ticker/24hr?symbol=${apiSymbol}`);
  if(!ticker) return;
  const depth = await fetchJson(`https://api.binance.com/api/v3/depth?symbol=${apiSymbol}&limit=50`);
  const trades = await fetchJson(`https://api.binance.com/api/v3/trades?symbol=${apiSymbol}&limit=100`);

  const price = +ticker.lastPrice;
  const prevPrice = state.prevPrice || price;
  if(!state.prevPrice) state.prevPrice = price;

  const [support,resistance] = depth? supportRes(depth) : [0,0];
  consumeTrades(trades);
  const sig = computeSignal(price,support,resistance,prevPrice);
  render(price,support,resistance,prevPrice);
  state.prevPrice = price;
}

function startMonitor(){ if(running) return; running=true; tick(); setInterval(()=>{ tick(); saveState(); },1000); }

// start if already logged in
if(localStorage.getItem('eagle_current_user')){ document.getElementById('auth-screen').style.display='none'; document.getElementById('dashboard').style.display='block'; startMonitor(); }

</script></body>
</html>
