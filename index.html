<!doctype html>

<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ù†Ø¸Ø§Ù… Ø¹ÙŠÙ† Ø§Ù„Ù†Ø³Ø± â€” Eagle Eye (Ù†Ø³Ø®Ø© ÙˆÙŠØ¨)</title>
  <!-- Tailwind CDN for quick styling (suitable for prototype/static) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* small extra styles to mimic terminal-ish card */
    body { background: linear-gradient(90deg,#0f172a 0%, #071024 100%); }
    .glass { background: rgba(255,255,255,0.03); backdrop-filter: blur(6px); }
    .mon { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", "Segoe UI Mono", monospace; }
    .logo-box { border-radius: .75rem; border: 1px solid rgba(255,255,255,0.04); }
  </style>
</head>
<body class="min-h-screen p-6 text-white">
  <div class="max-w-6xl mx-auto">
    <div class="p-4 logo-box glass mb-6 flex items-center gap-4">
      <img src="https://img.icons8.com/?size=512&id=108556&format=png" class="w-20 drop-shadow-xl" />
      <div class="flex items-center gap-4">
        <div class="rounded-md px-3 py-2 bg-gradient-to-r from-blue-700 to-cyan-500 text-white font-bold">ğŸ¦… Ø¹ÙŠÙ† Ø§Ù„Ù†Ø³Ø±</div>
        <div class="text-sm opacity-80">Ù†Ø³Ø®Ø© ÙˆÙŠØ¨ ØªØ¬Ø±ÙŠØ¨ÙŠØ© â€” Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ù† Binance (BTC/USDT)</div>
      </div>
    </div><div class="grid grid-cols-1 md:grid-cols-3 gap-6">
  <div class="col-span-2 glass p-4 rounded-xl">
    <div class="flex justify-between items-start">
      <div>
        <h2 class="text-2xl font-bold">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</h2>
        <div id="price" class="text-4xl font-extrabold mt-2">--</div>
        <div id="price-change" class="text-sm mt-1 opacity-80"></div>
      </div>
      <div class="text-right">
        <div class="text-sm opacity-80">Ø§Ù„ÙˆÙ‚Øª</div>
        <div id="now" class="mon font-semibold">--</div>
        <div class="mt-3 text-xs opacity-70">Ø·Ù„Ø¨Ø§Øª: <span id="requests">0</span></div>
      </div>
    </div>

    <hr class="my-4 border-gray-700" />

    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
      <div class="p-3 rounded-md glass">
        <div class="text-xs opacity-80">Ø§Ù„Ø¯Ø¹Ù…</div>
        <div id="support" class="font-semibold">--</div>
      </div>
      <div class="p-3 rounded-md glass">
        <div class="text-xs opacity-80">Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø©</div>
        <div id="resistance" class="font-semibold">--</div>
      </div>
      <div class="p-3 rounded-md glass">
        <div class="text-xs opacity-80">Ø¥Ø´Ø§Ø±Ø©</div>
        <div id="signal" class="font-bold text-yellow-300">âšª Ø§Ù†ØªØ¸Ø§Ø±</div>
        <div id="signal-txt" class="text-xs opacity-80 mt-1"></div>
      </div>
    </div>

    <hr class="my-4 border-gray-700" />

    <div>
      <h3 class="font-semibold">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØµÙÙ‚Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø© (ØªØ±Ø§ÙƒÙ…ÙŠ)</h3>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mt-3">
        <div class="p-3 rounded-md glass">
          <div class="text-xs opacity-80">Ø´Ø±Ø§Ø¡ ØªØ±Ø§ÙƒÙ…ÙŠ (BTC)</div>
          <div id="cum-buys" class="font-semibold">0.0000</div>
        </div>
        <div class="p-3 rounded-md glass">
          <div class="text-xs opacity-80">Ø¨ÙŠØ¹ ØªØ±Ø§ÙƒÙ…ÙŠ (BTC)</div>
          <div id="cum-sells" class="font-semibold">0.0000</div>
        </div>
        <div class="p-3 rounded-md glass">
          <div class="text-xs opacity-80">ÙØ±Ù‚ ØªØ±Ø§ÙƒÙ…ÙŠ (BTC)</div>
          <div id="cum-diff" class="font-semibold">0.0000</div>
        </div>
      </div>
    </div>

  </div>

  <div class="glass p-4 rounded-xl">
    <h3 class="font-semibold">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø«Ø§Ù†ÙŠØ©</h3>
    <div class="mt-3 text-sm">
      <div>Ø´Ø±Ø§Ø¡ / Ø«Ø§Ù†ÙŠØ©: <span id="sec-buy">0.0000</span> BTC</div>
      <div>Ø¨ÙŠØ¹ / Ø«Ø§Ù†ÙŠØ©: <span id="sec-sell">0.0000</span> BTC</div>
      <div class="mt-2">Ø§Ù„ÙØ±Ù‚: <span id="sec-diff">0.0000</span> BTC</div>
    </div>

    <hr class="my-3 border-gray-700" />

    <div class="text-sm opacity-80">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</div>
    <div class="mt-2 text-xs">
      Ø¹ØªØ¨Ø© Ø§Ù„ØªÙØ§ÙˆØª: <input id="vol-threshold" class="w-20 text-black rounded px-1" value="10"> BTC<br>
      ÙˆÙ‚Øª Ø§Ù„ØªØ¨Ø±ÙŠØ¯ (Ø«): <input id="cooldown" class="w-20 text-black rounded px-1" value="20">
    </div>

    <hr class="my-3 border-gray-700" />
    <div class="text-xs opacity-70">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</div>
    <ul class="text-xs mt-2 opacity-80 list-disc list-inside">
      <li>Ù‡Ø°Ù‡ Ù†Ø³Ø®Ø© ÙˆØ§Ø¬Ù‡Ø© Ø£Ù…Ø§Ù…ÙŠØ© ÙÙ‚Ø· â€” Ù‚Ø¯ ØªÙˆØ§Ø¬Ù‡ Ø­Ø¯ÙˆØ¯ CORS Ø£Ùˆ Ù‚ÙŠÙˆØ¯ Ù…Ø¹Ø¯Ù„ Ù…Ù† Binance.</li>
      <li>Ù„Ù„Ù†Ø´Ø± Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ Ø§Ø³ØªØ®Ø¯Ù… ÙˆØ¸ÙŠÙØ© Ø³ÙŠØ±ÙØ± (Serverless) ÙƒØ¨Ø±ÙˆÙƒØ³ÙŠ Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù€ API.</li>
    </ul>

  </div>
</div>

<footer class="mt-6 text-center text-xs opacity-70">Ø¨ÙÙ†ÙŠØª Ø¨Ø³Ø±Ø¹Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¨Ø§ÙŠØ«ÙˆÙ† Ø¥Ù„Ù‰ ÙˆØ§Ø¬Ù‡Ø© ÙˆÙŠØ¨ â€” EagleEye OneShot (Prototype)</footer>

  </div>  <script>
  // ====== Ø­ÙØ¸ ÙˆØ§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø­Ø§Ù„Ø© Ù…Ù† localStorage ======
  function saveState(){ localStorage.setItem('eagle_state', JSON.stringify(state)); }
  function loadState(){ const s = localStorage.getItem('eagle_state'); if(s){ try{ Object.assign(state, JSON.parse(s)); }catch(e){} } }
  loadState();
  /* ======== Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¹Ù…ÙŠÙ„ â€” ÙŠÙØ­Ø§ÙƒÙŠ Ø³Ù„ÙˆÙƒ Ø§Ù„Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ø£ØµÙ„ÙŠ ======== */
  const API = {
    ticker: 'https://api.binance.com/api/v3/ticker/24hr?symbol=BTCUSDT',
    depth:  'https://api.binance.com/api/v3/depth?symbol=BTCUSDT&limit=50',
    trades: 'https://api.binance.com/api/v3/trades?symbol=BTCUSDT&limit=100'
  };

  let state = {
    prevPrice: 0.0,
    cumBuys: 0.0,
    cumSells: 0.0,
    lastTradeId: null,
    secBuy: 0.0,
    secSell: 0.0,
    lastSecondTs: 0,
    requestCount: 0,
    volThreshold: 10.0,
    cooldownSec: 20,
    lastSignalTime: 0,
    currentSignal: 'âšª Ø§Ù†ØªØ¸Ø§Ø±',
    currentTxt: 'Ø§Ù„Ø³ÙˆÙ‚ Ù‡Ø§Ø¯Ø¦ØŒ Ù†Ù†ØªØ¸Ø± ØªÙØ§ÙˆØª ÙÙŠ Ø§Ù„ÙƒÙ…ÙŠØ©'
  };

  function formatPrice(x){ return typeof x==='number' ? x.toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2}) : x }
  function nowStr(){ return new Date().toLocaleString('ar-EG'); }

  async function fetchJson(url){
    try{
      const r = await fetch(url);
      if(!r.ok) throw new Error(r.statusText);
      state.requestCount++;
      return await r.json();
    }catch(e){
      console.warn('fetch error',e);
      return null;
    }
  }

  function supportResistanceFromBook(ob){
    try{
      const bids = (ob.bids||[]).map(b=>[parseFloat(b[0]),parseFloat(b[1])]);
      const asks = (ob.asks||[]).map(a=>[parseFloat(a[0]),parseFloat(a[1])]);
      const support = bids.length? bids.reduce((a,b)=> a[1]>b[1]?a:b)[0] : 0;
      const resistance = asks.length? asks.reduce((a,b)=> a[1]>b[1]?a:b)[0] : 0;
      return [support,resistance];
    }catch(e){ return [0,0]; }
  }

  function consumeNewTrades(trades){
    if(!trades || !trades.length) return [0,0,null,null];
    trades.sort((a,b)=>a.id-b.id);
    if(state.lastTradeId===null){ state.lastTradeId = trades[trades.length-1].id; return [0,0,null,null]; }
    let buy=0,sell=0,first=null,last=null;
    for(const t of trades){ if(t.id>state.lastTradeId){ const q=parseFloat(t.qty); if(t.isBuyerMaker) sell+=q; else buy+=q; if(first===null) first=t.id; last=t.id; }}
    if(last!==null) state.lastTradeId = last;
    state.cumBuys += buy; state.cumSells += sell;
    const now = Math.floor(Date.now()/1000);
    if(now !== state.lastSecondTs){ state.secBuy = buy; state.secSell = sell; state.lastSecondTs = now; } else { state.secBuy += buy; state.secSell += sell; }
    return [buy,sell,first,last];
  }

  function maybeFireSignal(price,support,resistance){
    const now = Math.floor(Date.now()/1000);
    const inCooldown = (now - state.lastSignalTime) < state.cooldownSec;
    const cumDiff = Math.abs(state.cumBuys - state.cumSells);
    const cumImb = state.cumBuys - state.cumSells;
    if(cumDiff >= state.volThreshold && cumImb > 0){
      if(!inCooldown || state.currentSignal !== 'ğŸŸ¢ Ø´Ø±Ø§Ø¡ 100%'){
        const target = resistance>0? resistance : price*1.01;
        state.currentSignal = 'ğŸŸ¢ Ø´Ø±Ø§Ø¡ 100%';
        state.currentTxt = `ØªÙÙˆÙ‚ ØªØ±Ø§ÙƒÙ…ÙŠ ÙÙŠ ÙƒÙ…ÙŠØ© Ø§Ù„Ø´Ø±Ø§Ø¡ â†’ Ù‡Ø¯Ù Ø£ÙˆÙ„ ~ ${target.toFixed(2)}$`;
        state.lastSignalTime = now;
      }
      return;
    }
    if(cumDiff >= state.volThreshold && cumImb < 0){
      if(!inCooldown || state.currentSignal !== 'ğŸ”´ Ø¨ÙŠØ¹ 100%'){
        const target = support>0? support : price*0.99;
        state.currentSignal = 'ğŸ”´ Ø¨ÙŠØ¹ 100%';
        state.currentTxt = `ØªÙÙˆÙ‚ ØªØ±Ø§ÙƒÙ…ÙŠ ÙÙŠ ÙƒÙ…ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹ â†’ Ù‡Ø¯Ù Ø£ÙˆÙ„ ~ ${target.toFixed(2)}$`;
        state.lastSignalTime = now;
      }
      return;
    }
    if(!inCooldown && !state.currentSignal.startsWith('âšª')){
      state.currentSignal = 'âšª Ø§Ù†ØªØ¸Ø§Ø±';
      state.currentTxt = 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙØ§ÙˆØª ÙˆØ§Ø¶Ø­ ÙÙŠ Ø§Ù„ÙƒÙ…ÙŠØ©. Ù†Ù†ØªØ¸Ø± ÙØ±Ù‚Ù‹Ø§ ÙŠØ¨Ù„Øº '+state.volThreshold+'+ BTC.';
    }
  }

  function render(price,support,resistance){
    document.getElementById('now').textContent = nowStr();
    document.getElementById('requests').textContent = state.requestCount;
    document.getElementById('price').textContent = '$' + formatPrice(price);
    const change = price - state.prevPrice;
    const changePercent = state.prevPrice? (change/state.prevPrice*100):0;
    const chEl = document.getElementById('price-change');
    chEl.textContent = `${change>=0? 'â–²':'â–¼'} ${Math.abs(change).toFixed(2)} (${Math.abs(changePercent).toFixed(2)}%)`;
    document.getElementById('support').textContent = support? '$'+formatPrice(support):'--';
    document.getElementById('resistance').textContent = resistance? '$'+formatPrice(resistance):'--';
    const sigEl = document.getElementById('signal'); sigEl.textContent = state.currentSignal;
    document.getElementById('signal-txt').textContent = state.currentTxt;
    document.getElementById('cum-buys').textContent = state.cumBuys.toFixed(4);
    document.getElementById('cum-sells').textContent = state.cumSells.toFixed(4);
    document.getElementById('cum-diff').textContent = (state.cumBuys - state.cumSells).toFixed(4);
    document.getElementById('sec-buy').textContent = state.secBuy.toFixed(4);
    document.getElementById('sec-sell').textContent = state.secSell.toFixed(4);
    document.getElementById('sec-diff').textContent = (state.secBuy - state.secSell).toFixed(4);
  }

  async function tick(){
    // read UI inputs
    const thresh = parseFloat(document.getElementById('vol-threshold').value||'10');
    const cooldown = parseInt(document.getElementById('cooldown').value||'20');
    state.volThreshold = isFinite(thresh)? thresh: state.volThreshold;
    state.cooldownSec = isFinite(cooldown)? cooldown: state.cooldownSec;

    const ticker = await fetchJson(API.ticker);
    if(!ticker) return;
    const orderBook = await fetchJson(API.depth);
    const trades = await fetchJson(API.trades);

    const price = parseFloat(ticker.lastPrice || 0);
    if(!state.prevPrice) state.prevPrice = price;
    const [support,resistance] = orderBook? supportResistanceFromBook(orderBook) : [0,0];
    consumeNewTrades(trades);
    maybeFireSignal(price,support,resistance);
    render(price,support,resistance);
    state.prevPrice = price;
  }

  // start loop
  setInterval(tick, 1000);
  setInterval(saveState, 1000);
  // also run immediately
  tick();

  </script></body>
</html>
